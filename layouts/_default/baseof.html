<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}">
<head>
    <!-- ========================[ 여기부터 추가 ]======================== -->
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-L7XZJ99H8F"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-L7XZJ99H8F');
    </script>
    <!-- ========================[ 여기까지 추가 ]======================== -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ block "title" . }}{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}{{ end }}</title>
    
    <meta name="description" content="{{ with .Description }}{{ . }}{{ else }}{{ if .IsPage }}{{ .Summary }}{{ else }}{{ with .Site.Params.description }}{{ . }}{{ end }}{{ end }}{{ end }}">
    <meta name="author" content="{{ .Site.Params.author }}">
    
    {{ $style := resources.Get "css/style.scss" | resources.ExecuteAsTemplate "style.scss.tpl" . | toCSS | resources.Minify | resources.Fingerprint }}
    <link rel="stylesheet" href="{{ $style.Permalink }}">

      <link rel="icon" type="image/x-icon" href="{{ "favicon.ico" | relURL }}">
      <link rel="shortcut icon" type="image/x-icon" href="{{ "favicon.ico" | relURL }}">
      <!-- [추가] 오픈그래프(OG) 및 트위터 카드 메타 태그 -->

    <meta property="og:site_name" content="{{ .Site.Title }}">
    {{ if .IsHome }}
        <meta property="og:title" content="{{ .Site.Title }}">
        <meta property="og:type" content="website">
    {{ else }}
        <meta property="og:title" content="{{ .Title }} | {{ .Site.Title }}">
        <meta property="og:type" content="article">
    {{ end }}
    <meta property="og:description" content="{{ with .Description }}{{ . }}{{ else }}{{ if .IsPage }}{{ .Summary | plainify | truncate 160 "..." }}{{ else }}{{ with .Site.Params.description }}{{ . }}{{ end }}{{ end }}{{ end }}">
    <meta property="og:url" content="{{ .Permalink }}">
    {{ $ogImage := "" }}
    {{ if .Params.image }}
        {{ $ogImage = resources.Get .Params.image }}
    {{ end }}
    {{ if not $ogImage }}
        {{ $ogImage = resources.Get "images/og-default.png" }}
    {{ end }}
    {{ with $ogImage }}
        <meta property="og:image" content="{{ .Permalink }}">
        <meta property="og:image:width" content="{{ .Width }}">
        <meta property="og:image:height" content="{{ .Height }}">
    {{ end }}

    <!-- 트위터 카드 태그 (OG와 대부분 동일한 정보를 사용합니다) -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }}{{ end }}">
    <meta name="twitter:description" content="{{ with .Description }}{{ . }}{{ else }}{{ if .IsPage }}{{ .Summary | plainify | truncate 160 "..." }}{{ else }}{{ with .Site.Params.description }}{{ . }}{{ end }}{{ end }}{{ end }}">
    {{ with $ogImage }}
        <meta name="twitter:image" content="{{ .Permalink }}">
    {{ end }}
    <!-- [끝] 오픈그래프(OG) 및 트위터 카드 메타 태그 -->
</head>
<body data-theme="default" class="{{ if and .File (eq .File.BaseFileName "search") }}is-search-page{{ end }}">

    <header id="main-header">
        <div class="container">
            <div class="logo">
                <a href="{{ "/" | relURL }}">
                    <span class="logo-main">{{ .Site.Title }}</span>
                    <span class="logo-sub">{{ .Site.Params.subtitle }}</span>
                </a>
            </div>
            <nav>
                <ul>
                    {{ range .Site.Menus.main }}
                    <li>
                        <a href="{{ .URL | relURL }}" {{ if .Params.target }}target="{{ .Params.target }}" rel="noopener noreferrer"{{ end }}>
                            {{ .Name }}
                        </a>
                    </li>
                    {{ end }}
                </ul>
            </nav>
        </div>
    </header>

    <main>
        {{ block "main" . }}{{ end }}
    </main>

    <footer id="main-footer">
        <div class="container">
            <div class="footer-info">
                <p>© {{ now.Format "2006" }} {{ .Site.Title }}. All Rights Reserved.</p>
                <a href="{{ (.Site.GetPage "privacy.html").RelPermalink }}" class="footer-privacy-link">개인정보처리방침</a>
            </div>
            
            <div class="footer-theme-selector">
                <div class="theme-buttons">
                    <button class="theme-btn" data-theme="default" aria-label="Default Theme"><span class="color-patch" style="background-color: #282c34;"></span><span class="color-patch" style="background-color: #64F0C8;"></span></button>
                    <button class="theme-btn" data-theme="cosmic-indigo" aria-label="Cosmic Indigo Theme"><span class="color-patch" style="background-color: #1A182F;"></span><span class="color-patch" style="background-color: #F0C419;"></span></button>
                    <button class="theme-btn" data-theme="aetherial-light" aria-label="Aetherial Light Theme"><span class="color-patch" style="background-color: #F8F9FA;"></span><span class="color-patch" style="background-color: #A0D2DB;"></span></button>
                </div>
            </div>
        </div>
    </footer>

    <!-- 원래의 정상 작동하던 스크립트로 완전 복구 -->
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const themeButtons = document.querySelectorAll('.theme-btn');
        const body = document.body;
        const giscusThemeMap = { 'default': 'dark_dimmed', 'cosmic-indigo': 'dark_dimmed', 'aetherial-light': 'light' };
        
        const updateGiscusTheme = (themeName) => {
            const giscusFrame = document.querySelector('iframe.giscus-frame');
            if (!giscusFrame) return;
            const giscusTheme = giscusThemeMap[themeName] || 'dark_dimmed';
            // setTimeout을 추가하여 giscus 프레임이 메시지를 받을 준비가 될 때까지 약간의 시간을 줍니다.
            setTimeout(() => { 
                giscusFrame.contentWindow.postMessage({ giscus: { setConfig: { theme: giscusTheme } } }, 'https://giscus.app');
            }, 100);
        };
        
        const applyTheme = (themeName) => {
            if (!themeName) return;
            body.setAttribute('data-theme', themeName);
            themeButtons.forEach(btn => { 
                btn.classList.toggle('active', btn.dataset.theme === themeName); 
            });
            updateGiscusTheme(themeName);
        };

        const savedTheme = localStorage.getItem('archive03-theme') || 'default';
        applyTheme(savedTheme);

        themeButtons.forEach(button => {
            button.addEventListener('click', () => {
                const selectedTheme = button.dataset.theme;
                applyTheme(selectedTheme);
                localStorage.setItem('archive03-theme', selectedTheme);
            });
        });

        const commentsSection = document.querySelector('.post-comments');
        if (commentsSection) {
            const observer = new IntersectionObserver((entries, obs) => {
                if (entries[0].isIntersecting) {
                    const applyGiscusThemeOnLoad = () => {
                        const giscusFrame = document.querySelector('iframe.giscus-frame');
                        if (giscusFrame) {
                            const currentTheme = localStorage.getItem('archive03-theme') || 'default';
                            updateGiscusTheme(currentTheme);
                        } else {
                            setTimeout(applyGiscusThemeOnLoad, 200); // 프레임이 없으면 0.2초 후 재시도
                        }
                    };
                    applyGiscusThemeOnLoad();
                    obs.disconnect();
                }
            }, { threshold: 0.01 });
            observer.observe(commentsSection);
        }
    });
    </script>
</body>
</html>